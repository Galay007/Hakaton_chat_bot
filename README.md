# Telegram Export Participants Bot

Инструмент для безопасного извлечения уникальных участников Telegram-чата из файлов экспорта (JSON) с генерацией Excel-отчёта или списков внутри чата.

## Возможности
- Поддержка JSON (стандартный экспорт Telegram).
- Можно отправлять неограниченное кол-во файлов. Telegram сам поделит их на сообщения, если отправлено  более 10 файлов.
- Задается ограничение на размер каждого файла в настройках бота. По умолчанию 10мб (можно поменять в настройках бота
или задать в переменной окружения MAX_SIZE).
- Поиск авторов сообщений и `@`-упоминаний, выделение каналов.
- Автоматическая фильтрация удалённых аккаунтов и дубликатов.
- Выдача результата в виде сообщения (до 50 участников) или Excel с тремя вкладками (участники, упоминания, каналы).
- Готовые Docker/Docker Compose манифесты, документация и пример отчёта.

## Быстрый старт

### 1. Переменные окружения
Создайте `BOT_TOKEN` с токеном вашего Telegram-бота (через [@BotFather](https://t.me/BotFather)). Опционально можно задать:

| Переменная | Значение по умолчанию | Назначение |
|------------|-----------------------|------------|
| `INLINE_THRESHOLD` | `50` | Порог для ответа списком вместо Excel |
| `BOT_TZ` | `UTC` | Таймзона для отображения дат |

### 2. Локальный запуск
```bash
python -m venv .venv
.venv/Scripts/activate  # Windows
pip install -r requirements.txt
set BOT_TOKEN=123:ABC  # Windows PowerShell: $Env:BOT_TOKEN="..."
python -m src.main
```

### 3. Запуск через Docker
```bash
docker compose up --build -d
```
Контейнер стартует процесс `python -m src.main`. Логи можно получить командой `docker compose logs -f`.

## Пользовательский сценарийp
1. Пользователь вводит `/start` и получает инструкцию с лимитами.
2. Загружает один или несколько файлов экспорта (JSON). Каждый файл не более указанного лимита 
в настройках бота. Бот подтверждает обработку каждого файла.
3. После загрузки выполняет `/export`:
   - если уникальных участников < 50 — бот присылает список в чат;
   - иначе отправляется Excel-файл с вкладками «Участники», «Упоминания», «Каналы».
4. Данные сессии очищаются автоматически (можно сбросить вручную через `/reset`). Никакие файлы не сохраняются.

## Архитектура
Модули и их ответственность:

| Модуль | Файл | Роль |
|--------|------|------|
| `BotHandler` | `src/bot_handler.py` | Управление командами, обработка состояний пользователей и отправка результатов |
| `FileManager` | `src/file_manager.py` | Проверка типа файла и загрузка содержимого полностью в память |
| `DataParser` | `src/data_parser.py` | Детектирование формата, извлечение авторов, упоминаний и каналов |
| `DataProcessor` | `src/data_processor.py` | Связка над парсером, выдаёт структурированные данные |
| `SessionData` | `src/models.py` | Ин-мемори сессия пользователя, дедупликация |
| `ExcelGenerator` | `src/excel_generator.py` | Формирование Excel через `pandas`/`XlsxWriter` |
| `main` | `src/main.py` | Точка входа, загрузка настроек, конфигурация логов |

Поток данных соответствует требованиям: файлы скачиваются напрямую в память, проходят парсинг, результаты сразу выдаются пользователю. Параллельные сессии пользователей изолированы.

## Тестирование
- Рекомендуется подготовить небольшие JSON экспорты и проверять оба сценария вывода (список + Excel).
- В режиме разработки можно запускать `python -m src.main` и работать с тестовым ботом.

## Документация и артефакты
- `docs/architecture.md` — расширенное описание модулей, последовательности вызовов и безопасности.
- `docs/user_guide.md` — инструкция для конечного пользователя.
- `docs/presentation_outline.md` — каркас презентации на 10–15 слайдов (роль каждого участника).
- `artifacts/sample_output.xlsx` — пример отчёта с тремя вкладками.

## Лицензия
Проект предназначен для использования в рамках хакатона МИФИ. При необходимости путь к лицензии можно доработать. 
